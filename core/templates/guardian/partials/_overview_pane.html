{% load static humanize message_filters %}

<h5 class="mb-3">At-a-Glance Overview</h5>
<div class="row g-3">
    <div class="col-md-6 col-xl-4">
        <div class="card stat-card h-100 shadow-sm">
            <div class="card-body d-flex align-items-center">
                <div class="stat-card-icon bg-primary text-white me-3"><i class="fas fa-user-check"></i></div>
                <div>
                    <div class="stat-card-title">ATTENDANCE</div>
                    {% with ad=attendance_data|get_item:student.user.id %}
                    <div class="stat-card-value">{{ ad.attendance_percentage|default:0 }}%</div>
                    {% endwith %}
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-xl-4">
        <div class="card stat-card h-100 shadow-sm" style="border-left-color: var(--bs-success);">
            <div class="card-body d-flex align-items-center">
                {% with sa=assignments_data|get_item:student.user.id %}
                <div class="stat-card-icon bg-success text-white me-3"><i class="fas fa-book"></i></div>
                <div>
                    <div class="stat-card-title">ASSIGNMENTS</div>
                    <div class="stat-card-value">{{ sa.completed|default:0 }}/{{ sa.total|default:0 }}</div>
                </div>
                {% endwith %}
            </div>
        </div>
    </div>

    <div class="col-md-12 col-xl-4">
        <div class="card stat-card h-100 shadow-sm" style="border-left-color: var(--bs-danger);">
            <div class="card-body d-flex align-items-center">
                {% with fd=financial_data|get_item:student.user.id %}
                <div class="stat-card-icon bg-danger text-white me-3"><i class="fas fa-wallet"></i></div>
                <div>
                    <div class="stat-card-title">FEES DUE</div>
                    <div class="stat-card-value">
                        {% if fd %}
                            â‚¦{{ fd.outstanding_balance|floatformat:0|intcomma }}
                        {% else %}
                            <span class="text-muted">N/A</span>
                        {% endif %}
                    </div>
                </div>
                {% endwith %}
            </div>
        </div>
    </div>
</div>

<div class="card mt-4 shadow-sm">
    <div class="card-header"><h6 class="mb-0">Attendance Details</h6></div>
    <div class="card-body">
        {% with ad=attendance_data|get_item:student.user.id %}
            <div class="row text-center">
                <div class="col"><strong>Total Days:</strong> {{ ad.total_days|default:0 }}</div>
                <div class="col"><strong>Present:</strong> {{ ad.present_days|default:0 }}</div>
                <div class="col"><strong>Absent:</strong> {{ ad.absent_days|default:0 }}</div>
            </div>
            <div class="progress mt-3" style="height: 18px; border-radius: 12px; overflow: hidden;">
                <div class="progress-bar bg-primary" role="progressbar" style="width: {{ ad.attendance_percentage|default:0 }}%;" aria-valuenow="{{ ad.attendance_percentage|default:0 }}">
                    {{ ad.attendance_percentage|floatformat:1 }}%
                </div>
            </div>
        {% endwith %}
    </div>
</div>