{% extends 'base.html' %} 
{% load static %}
{% load humanize %} 

{% block title %}Admin Dashboard{% endblock %}

{% block page_title %}Admin Dashboard{% endblock %} 

{% block content %}
<br>
<!-- === Top Stats Row === -->
<div class="row g-4 mb-4">
    <div class="col-md-6 col-xl-3">
        <div class="card text-white bg-primary shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                <div class="flex-shrink-0 me-3">
                    <i class="fas fa-user-graduate fa-3x"></i>
                </div>
                <div class="flex-grow-1">
                    <div class="fs-4 fw-bold">{{ student_count|default:0 }}</div>
                    <div class="text-white-75 small">Total Students</div>
                </div>
                 {# Optional: Link to list #}
                 <a href="{% url 'student_list' %}" class="stretched-link text-white-50 small"><i class="fas fa-arrow-circle-right"></i></a>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-xl-3">
        <div class="card text-white bg-success shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                 <div class="flex-shrink-0 me-3">
                    <i class="fas fa-chalkboard-teacher fa-3x"></i>
                </div>
                 <div class="flex-grow-1">
                    <div class="fs-4 fw-bold">{{ teacher_count|default:0 }}</div>
                    <div class="text-white-75 small">Total Teachers</div>
                 </div>
                 <a href="{% url 'teacher_list' %}" class="stretched-link text-white-50 small"><i class="fas fa-arrow-circle-right"></i></a>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-xl-3">
         <div class="card text-white bg-info shadow-sm h-100">
            <div class="card-body d-flex align-items-center">
                 <div class="flex-shrink-0 me-3">
                    <i class="fas fa-user-shield fa-3x"></i> {# Changed Icon #}
                </div>
                 <div class="flex-grow-1">
                    <div class="fs-4 fw-bold">{{ guardian_count|default:0 }}</div>
                    <div class="text-white-75 small">Total Guardians</div>
                 </div>
                 <a href="{% url 'guardian_list' %}" class="stretched-link text-white-50 small"><i class="fas fa-arrow-circle-right"></i></a>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-xl-3">
         <div class="card text-white bg-secondary shadow-sm h-100"> {# Changed color #}
            <div class="card-body d-flex align-items-center">
                 <div class="flex-shrink-0 me-3">
                    <i class="fas fa-school fa-3x"></i>
                </div>
                 <div class="flex-grow-1">
                    <div class="fs-4 fw-bold">{{ class_count|default:0 }}</div>
                    <div class="text-white-75 small">Total Classes</div>
                 </div>
                  <a href="{% url 'class_list' %}" class="stretched-link text-white-50 small"><i class="fas fa-arrow-circle-right"></i></a>
            </div>
        </div>
    </div>
    {# Add more stats cards here if needed (subjects, payments etc.) using similar structure #}
</div>
<!-- === End Top Stats Row === -->


<!-- === Main Content Row (Cards for Actions) === -->
<div class="row g-4">

    <!-- Column 1: User Management & Setup -->
    <div class="col-lg-6 col-xl-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light fw-bold">
                <i class="fas fa-users-cog me-2 text-primary"></i>User Management & Setup
            </div>
            <div class="list-group list-group-flush">
                 <a href="{% url 'student_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-user-graduate fa-fw me-2 text-muted"></i>Students</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'teacher_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                     <span><i class="fas fa-chalkboard-teacher fa-fw me-2 text-muted"></i>Teachers</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'guardian_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-user-shield fa-fw me-2 text-muted"></i>Guardians</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'enrol_student' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                     <span><i class="fas fa-user-plus fa-fw me-2 text-muted"></i>Enrol Students</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 {# Suggestion: Add link to manage user accounts/permissions if separate #}
                 <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-user-lock fa-fw me-2 text-muted"></i>Manage User Accounts</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
            </div>
        </div>
    </div>

    <!-- Column 2: Academic Structure -->
    <div class="col-lg-6 col-xl-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light fw-bold">
                 <i class="fas fa-sitemap me-2 text-success"></i>Academic Structure
            </div>
             <div class="list-group list-group-flush">
                 <a href="{% url 'session_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                     <span><i class="far fa-calendar-alt fa-fw me-2 text-muted"></i>Manage Sessions</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'term_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                     <span><i class="far fa-calendar-check fa-fw me-2 text-muted"></i>Manage Terms</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'class_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-school fa-fw me-2 text-muted"></i>Manage Classes</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'subject_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                     <span><i class="fas fa-book fa-fw me-2 text-muted"></i>Manage Subjects</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'teacher_assignment_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                     <span><i class="fas fa-user-tag fa-fw me-2 text-muted"></i>Assign Teachers to Class</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'subject_assignment_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                     <span><i class="fas fa-chalkboard fa-fw me-2 text-muted"></i>Assign Subjects to Teachers</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
            </div>
        </div>
    </div>

    <!-- Column 3: Financial Management -->
    <div class="col-lg-6 col-xl-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light fw-bold">
                <i class="fas fa-dollar-sign me-2 text-info"></i>Financial Management
            </div>
             <div class="list-group list-group-flush">
                 <a href="{% url 'fee_assignment_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-tasks fa-fw me-2 text-muted"></i>Set Fees per Class/Term</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'student_fee_record_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                     <span><i class="fas fa-file-invoice-dollar fa-fw me-2 text-muted"></i>Manage Discounts/Waivers</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'payment_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                     <span><i class="fas fa-money-check-alt fa-fw me-2 text-muted"></i>View/Record Payments</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'financial_record_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                     <span><i class="fas fa-chart-line fa-fw me-2 text-muted"></i>View Financial Summaries</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 {# Suggestion: Link to overall financial reports if available #}
                 <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-chart-pie fa-fw me-2 text-muted"></i>Financial Reports</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                 </a> 
            </div>
        </div>
    </div>

     <!-- Column 4: Assessments & Results -->
    <div class="col-lg-6 col-xl-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light fw-bold">
                 <i class="fas fa-clipboard-check me-2 text-warning"></i>Assessments & Results
            </div>
             <div class="list-group list-group-flush">
                 <a href="{% url 'admin_assessment_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-pen-alt fa-fw me-2 text-muted"></i>Manage Assessments (CA)</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'admin_exam_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-file-signature fa-fw me-2 text-muted"></i>Manage Exams</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                  {# Suggestion: Link to manage result entry/approval #}
                 <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-marker fa-fw me-2 text-muted"></i>Enter/Approve Results</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'termly_broadsheets' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-table fa-fw me-2 text-muted"></i>View Termly Broadsheets</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'sessional_broadsheets' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-table fa-fw me-2 text-muted"></i>View Session Broadsheets</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
                 <a href="{% url 'admin_leaderboard_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-trophy me-2 text-muted"></i>View Class Leaderboards</span>
                     <i class="fas fa-chevron-right text-muted small"></i>
                 </a>
            </div>
        </div>
    </div>

    <!-- Column 5: Communication, System & Blog Management -->
    <div class="col-lg-6 col-xl-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light fw-bold">
                <i class="fas fa-bullhorn me-2 text-danger"></i>Communication, System & Blog
            </div>
            <div class="list-group list-group-flush">
                <a href="{% url 'notification_list' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-bell fa-fw me-2 text-muted"></i>Manage Notifications</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                </a>
                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-envelope fa-fw me-2 text-muted"></i>Internal Messaging</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                </a>

                {# === Blog Management Sub-section === #}
                <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" data-bs-toggle="collapse" href="#blogManagementCardCollapse" role="button" aria-expanded="false" aria-controls="blogManagementCardCollapse">
                    <span><i class="fas fa-newspaper fa-fw me-2 text-muted"></i>Blog Management</span>
                    <i class="fas fa-chevron-down text-muted small"></i> {# Chevron down for collapsible #}
                </a>
                <div class="collapse" id="blogManagementCardCollapse">
                    <div class="list-group list-group-flush border-top-0">
                        <a href="{% url 'post_manage_list' %}" class="list-group-item list-group-item-action ps-4"> {# Indent sub-item #}
                            <i class="fas fa-pen-square fa-fw me-2 text-muted small"></i>Manage Posts
                        </a>
                        <a href="{% url 'manage_category_list' %}" class="list-group-item list-group-item-action ps-4">
                            <i class="fas fa-folder-open fa-fw me-2 text-muted small"></i>Manage Categories
                        </a>
                        <a href="{% url 'manage_tag_list' %}" class="list-group-item list-group-item-action ps-4">
                            <i class="fas fa-tags fa-fw me-2 text-muted small"></i>Manage Tags
                        </a>
                         <a href="{% url 'post_list' %}" target="_blank" class="list-group-item list-group-item-action ps-4"> {# Link to public blog #}
                            <i class="fas fa-globe fa-fw me-2 text-muted small"></i>View Public Blog
                        </a>
                    </div>
                </div>
                {# === End Blog Management Sub-section === #}

                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-cog fa-fw me-2 text-muted"></i>System Settings</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                </a>
                <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-history fa-fw me-2 text-muted"></i>Activity Log</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                </a>
            </div>
        </div>
    </div>
    <!-- === End Column 5 === -->

    <!-- === Column: Data & LMS  === -->
    <div class="col-lg-6 col-xl-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light fw-bold">
                <i class="fas fa-chart-bar me-2 text-secondary"></i>Data & LMS
            </div>
            
            <!-- Chart goes in the card body -->
            <div class="card-body">
                <p class="text-muted small">A high-level overview of key school metrics.</p>
                <canvas id="studentDistributionChart" height="200"></canvas>
            </div>
            
            <!-- Action links go in a list-group below the body -->
            <div class="list-group list-group-flush">
                <a href="{% url 'lsalms:admin_lms_dashboard' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-tachometer-alt fa-fw me-2 text-muted"></i>LMS Mission Control</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                </a>
                <a href="{% url 'admin:lsalms_course_changelist' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-book-open fa-fw me-2 text-muted"></i>Manage All Courses (Django Admin)</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                </a>
                <a href="{% url 'admin:lsalms_learningtrack_changelist' %}" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-route fa-fw me-2 text-muted"></i>Manage Learning Tracks</span>
                    <i class="fas fa-chevron-right text-muted small"></i>
                </a>
            </div>
        </div>
    </div>
</div>
<!-- === End Main Content Row === -->


<!-- === Recent Activities (Optional - can be large) === -->
{# Consider if this table is too large for the dashboard - maybe link to a separate page #}
<div class="row mt-4">
    <div class="col-12">
         <div class="card shadow-sm">
             <div class="card-header bg-light fw-bold">
                <i class="fas fa-history me-2 text-info"></i>Recent Enrollments
             </div>
              <div class="card-body p-0"> {# Remove padding for full-width table #}
                 <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0 small">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Class</th>
                                <th>Session</th>
                                <th>Term</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {# Assuming recent_enrollments is passed in context #}
                            {% for enrollment in recent_enrollments|slice:":5" %} {# Limit to recent 5 #}
                            <tr>
                                <td>{{ enrollment.student.user.get_full_name|default:"N/A" }}</td>
                                <td>{{ enrollment.class_enrolled.name|default:"N/A" }}</td>
                                <td>{{ enrollment.session.name|default:"N/A" }}</td>
                                <td>{{ enrollment.term.name|default:"N/A" }}</td>
                                <td>{{ enrollment.created_at|date:"d M Y, H:i" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center py-3 text-muted">No recent enrollments found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                 </div>
             </div>
             {# Link to full list if needed #}
              <div class="card-footer text-center bg-light border-top-0">
                 <a href="#" class="text-muted small">View All Enrollments »</a>
              </div>
        </div>
    </div>
</div>
<!-- === End Recent Activities === -->

{% endblock %}


{% block extra_js %}
{# <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script> #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const studentChartCtx = document.getElementById('studentDistributionChart');
    if (studentChartCtx) {
        const studentChart = new Chart(studentChartCtx.getContext('2d'), {
            type: 'doughnut', // Or 'bar', 'pie'
            data: {
                // Labels should come from context ideally
                labels: ['JSS 1', 'JSS 2', 'SSS 1', 'SSS 2', 'SSS 3'],
                 datasets: [{
                    label: 'Students per Class',
                     // Data should come from context ideally
                    data: [{{ student_counts_by_class.JSS1|default:0 }}, {{ student_counts_by_class.JSS2|default:0 }}, /* ... etc */ ],
                    backgroundColor: [ // Add more colors
                        'rgba(25, 135, 84, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 193, 7, 0.7)',
                        'rgba(108, 117, 125, 0.7)',
                        'rgba(220, 53, 69, 0.7)'
                    ],
                    borderColor: [ // Add more colors
                        'rgba(25, 135, 84, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 193, 7, 1)',
                         'rgba(108, 117, 125, 1)',
                         'rgba(220, 53, 69, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false, // Allow resizing height
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    title: {
                        display: true,
                        text: 'Student Distribution by Class'
                    }
                }
            }
        });
    } else {
        console.warn('Chart canvas element not found.');
    }
});
</script>
{% endblock %}